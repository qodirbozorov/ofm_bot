<!DOCTYPE html>
<html lang="uz">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rezyume shakli</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
  <style>
    body {
      font-family: "Inter", sans-serif;
      font-optical-sizing: auto;
      font-style: normal;
      background-color: #fefefe;
      color: #222;
    }

    .section {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 12px 0;

    }


    input,
    textarea,
    button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #444;
      color: #333;
    }

    label {
      font-weight: 600;
      margin-top: 6px;
    }

    .yoq-btn {
      width: 60px;
      font-weight: 600;
      display: inline-block;
      font-weight: 400;
      color: #fff;
      text-align: center;
      vertical-align: middle;
      user-select: none;
      background-color: #fd810d;
      border: 1px solid #d64b0a;
      padding: 0.375rem 0.75rem;
      font-size: 1rem;
      line-height: 1.5;
      border-radius: 0.375rem;
      transition: color 0.15s ease-in-out,
        background-color 0.15s ease-in-out,
        border-color 0.15s ease-in-out,
        box-shadow 0.15s ease-in-out;
      cursor: pointer;
    }

    /* Hover holati */
    span.btn-primary:hover {
      color: #fff;
      background-color: #fd810d;
      border-color: #d64b0a;
    }

    /* Fokus holati */
    span.btn-primary:focus {
      outline: 0;
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.5);
    }

    /* Faol (active) holati */
    span.btn-primary:active {
      color: #fff;
      background-color: #0a58ca;
      border-color: #0a53be;
    }

    /* Nogiron (disabled) holati */
    span.btn-primary.disabled,
    span.btn-primary:disabled {
      color: #fff;
      background-color: #0d6efd;
      border-color: #0d6efd;
      opacity: 0.65;
      pointer-events: none;
    }

    .rel-btn {
      display: inline-block;
      font-weight: 400;
      color: #fff;
      text-align: center;
      vertical-align: middle;
      user-select: none;
      background-color: #198754;
      border: 1px solid #198754;
      padding: 0.375rem 0.75rem;
      font-size: 1rem;
      line-height: 1.5;
      border-radius: 0.375rem;
      transition: color 0.15s ease-in-out,
        background-color 0.15s ease-in-out,
        border-color 0.15s ease-in-out,
        box-shadow 0.15s ease-in-out;
      cursor: pointer;
    }

    /* Hover */
  .rel-btn:hover {
      color: #fff;
      background-color: #1a975d;
      border-color: #759787;
    }


    .relative {
      padding: 25px;
      border-radius: 8px;
      margin: 8px 0;
      display: flex;
      flex-direction: column;
      background-color: #efefef;
    }
    .relative label {
      margin-bottom: 5px;
      margin-top: 8px;
    }


#readyBtn {
  margin: auto;
  display: inline-block;
  padding: 12px 28px;
  font-size: 16px;
  font-weight: bold;
  color: #fff;
  background: linear-gradient(135deg, #0d6efd, #0b5ed7);
  border: none;
  border-radius: 8px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: background 0.3s ease, transform 0.2s ease;
  background: linear-gradient(135deg, #0b5ed7, #0a58ca);
  transform: scale(1.03);
}

/* Hover effekti */
#readyBtn:hover {
  background: linear-gradient(135deg, #0b5ed7, #0a58ca);
  transform: scale(1.03);
}

/* Yaltirash (shining) effekt */
#readyBtn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -75%;
  width: 50%;
  height: 100%;
  background: linear-gradient(
    120deg,
    rgba(255, 255, 255, 0.6) 0%,
    rgba(255, 255, 255, 0.1) 60%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: skewX(-25deg);
}

/* Harakat animatsiyasi */
#readyBtn:hover::before {
  animation: shine 1s forwards;
}

@keyframes shine {
  0% {
    left: -75%;
  }
  100% {
    left: 125%;
  }
}


    #readyBtn[disabled] {
      opacity: .6;
    }
    #resumeForm {
      display: flex;
      flex-direction: column;
    }
  </style>
</head>

<body>
  <h2>Rezyume shakli</h2>
  <form id="resumeForm">
    <div class="section">
      <label>To‘liq Ism Familiya Sharifingiz</label>
      <input name="full_name" required placeholder="Aliyev Valijon Zokir o'g'li">

      <label>Tug‘ilgan sana</label>
      <input name="birth_date" type="date">

      <label>Tug‘ilgan joyi</label>
      <input name="birth_place" placeholder="Masalan: Andijon viloyati, Asaka tumani">

      <label>Millati</label>
      <input name="nationality" placeholder="O‘zbek">

      <label>Partiyaviyligi</label>
      <input name="party_membership" id="party_membership" placeholder="Masalan: Yo‘q yoki partiya nomi">
      <span class="yoq-btn" onclick="document.getElementById('party_membership').value='Yo‘q'">Yo‘q</span>

      <label>Ma’lumoti</label>
      <input name="education" placeholder="Magistr, Oliy, o‘rta maxsus, umumiy o‘rta">

      <label>Tamomlagan</label>
      <input name="university" placeholder="2024-yil, Asaka tumani 26-maktab">

      <label>Mutaxassisligi</label>
      <input name="specialization" id="specialization">
      <span class="yoq-btn" onclick="document.getElementById('specialization').value='Yo‘q'">Yo‘q</span>

      <label>Ilmiy darajasi</label>
      <input name="ilmiy_daraja" placeholder="Yo‘q">

      <label>Ilmiy unvoni</label>
      <input name="ilmiy_unvon" placeholder="Yo‘q">

      <label>Qaysi chet tillarini biladi</label>
      <input name="languages" placeholder="Ingliz, Rus">

      <label>Davlat mukofotlari bilan taqdirlanganmi</label>
      <input name="dav_mukofoti" placeholder="Yo‘q">

      <label>Xalq deputatlari ... (to‘liq ko‘rsatilishi lozim)</label>
      <input name="deputat" id="deputat">
      <span class="yoq-btn" onclick="document.getElementById('deputat').value='Yo‘q'">Yo‘q</span>

      <label>Doimiy yashash manzili (aniq ko'rsatilsin):</label>
      <input name="adresss" placeholder="Masalan: Andijon viloyati, Asaka tumani, Shodlik ko’chasi, 6-uy">

      <label>Joriy lavozim sanasi</label>
      <input type="text" name="current_position_date" placeholder="Masalan: 2025 yil 2 sentabrdan">

      <label>Joriy lavozim to‘liq</label>
      <input type="text" name="current_position_full"
        placeholder="Masalan: Toshkent transport universiteti 1-bosqich talabasi">

      <label>Mehnat faoliyati</label>
      <textarea name="work_experience"
        placeholder="Masalan: 2015-2020 - yillar. Toshkent sh. 1-maktabda O‘qituvchi,"></textarea>

      <label>Telefon raqami</label>
      <input type="text" name="phone" placeholder="+998901234567" required>

      <input type="hidden" name="tg_id" id="tg_id" value="{{ tg_id }}">

      <label>Rasm yuklash (3x4 hajmda bo'lishi shart)</label>
      <input type="file" name="photo" id="photo" accept="image/*">
    </div>

    <div class="section">
      <h3>Yaqin qarindoshlar</h3>
      <div id="relatives"></div>
      <button type="button" class="rel-btn" onclick="addRelative()">+ Qarindosh qo‘shish</button>
    </div>

    <button id="readyBtn" type="button" onclick="submitForm()"> ✅ Tayyor</button>
  </form>

  <script>
    function addRelative() {
      const c = document.getElementById('relatives');
      const div = document.createElement('div');
      div.className = 'relative';
      div.innerHTML = `
    <label>Qarindoshligi</label>
    <input name="relation_type" placeholder="ota/ona/aka/singil/turmush o'rtoq/o'g'il/qiz">
    <label>F.I.O.</label>
    <input name="relative_full_name">
    <label>Tug‘ilgan yili va joyi</label>
    <input name="b_year_place" placeholder="1980-yil, Toshkent shahri">
    <label>Ish joyi va lavozimi</label>
    <input name="job_title" placeholder="Toshkent shahri 16-maktab, O'qituvchi">
    <label>Yashash joyi</label>
    <input name="address" placeholder="Andijon viloyati, Asaka tumani, Shodlik ko’chasi, 6-uy">
  `;
      c.appendChild(div);
    }

    async function submitForm() {
      const btn = document.getElementById("readyBtn");
      btn.disabled = true; btn.innerText = "Yuklanmoqda...";

      const form = document.getElementById('resumeForm');
      const fd = new FormData(form);

      // relatives to JSON array
      const items = [];
      document.querySelectorAll('.relative').forEach(div => {
        items.push({
          relation_type: div.querySelector('[name="relation_type"]').value,
          full_name: div.querySelector('[name="relative_full_name"]').value,
          b_year_place: div.querySelector('[name="b_year_place"]').value,
          job_title: div.querySelector('[name="job_title"]').value,
          address: div.querySelector('[name="address"]').value
        });
      });
      fd.append("relatives", JSON.stringify(items));

      try {
        const res = await fetch("/send_resume_data", { method: "POST", body: fd });
        const out = await res.json();
        if (out.status === "success") {
          alert("✅ Ma’lumotnoma tayyor.\n\n✅ Chatda yuborildi!");
           setTimeout(() => {
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.close();
        }
      }, 500);
          if (window.Telegram && Telegram.WebApp) { Telegram.WebApp.close(); }
        } else { alert("❌ Xatolik: " + out.error); }
      } catch (e) {
        alert("❌ Serverga ulanishda xatolik: " + e.message);
      } finally {
        btn.disabled = false; btn.innerText = "Tayyor";
      }
    }
  </script>
</body>

</html>